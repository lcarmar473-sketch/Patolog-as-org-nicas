import React, { useState } from 'react';
import { 
  Heart, 
  Brain, 
  Wind, 
  Droplet, 
  AlertCircle, 
  Stethoscope, 
  CheckCircle2, 
  XCircle, 
  RotateCcw, 
  ShieldCheck, 
  Zap, 
  PhoneCall, 
  Activity, 
  ChevronRight,
  Clock
} from 'lucide-react';

const App = () => {
  const [activeTab, setActiveTab] = useState('learning');
  const [selectedPathology, setSelectedPathology] = useState(null);
  const [quizStarted, setQuizStarted] = useState(false);
  const [currentQuestion, setCurrentQuestion] = useState(0);
  const [score, setScore] = useState(0);
  const [showResult, setShowResult] = useState(false);
  const [feedback, setFeedback] = useState(null);

  const pathologies = [
    {
      id: 'cardio',
      title: 'Urgencias Cardiovasculares',
      subtitle: 'Infarto (IAM)',
      icon: <Heart className="text-red-500" />,
      color: 'border-red-500',
      bgColor: 'bg-red-50',
      symptoms: [
        'Dolor opresivo en el centro del pecho.',
        'Irradiación a brazo izquierdo o mandíbula.',
        'Piel pálida, sudorosa y náuseas.',
        'Dificultad para respirar.'
      ],
      actions: [
        { step: 'Reposo absoluto', text: 'Sentar al paciente con la espalda apoyada.' },
        { step: 'Aviso al 112', text: 'Indicar sospecha de infarto inmediatamente.' },
        { step: 'Aflojar ropa', text: 'Liberar cuello y cintura para facilitar la circulación.' },
        { step: 'No dejar solo', text: 'Vigilar consciencia por si entra en parada (PCR).' }
      ]
    },
    {
      id: 'neuro',
      title: 'Urgencias Neurológicas',
      subtitle: 'Ictus / ACV',
      icon: <Brain className="text-purple-500" />,
      color: 'border-purple-500',
      bgColor: 'bg-purple-50',
      symptoms: [
        'Boca torcida o asimetría facial.',
        'Falta de fuerza en un brazo o pierna.',
        'Dificultad para hablar o entender.',
        'Dolor de cabeza muy intenso y súbito.'
      ],
      actions: [
        { step: 'Detección FAST', text: 'Pedir que sonría, levante brazos y hable.' },
        { step: 'Anotar hora', text: 'Es vital saber cuándo empezaron los síntomas.' },
        { step: 'Posición', text: 'Cabeza elevada 30º si está consciente.' },
        { step: 'Traslado urgente', text: 'Llamar al 112: Código Ictus activado.' }
      ]
    },
    {
      id: 'resp',
      title: 'Urgencias Respiratorias',
      subtitle: 'Crisis Asmática',
      icon: <Wind className="text-blue-500" />,
      color: 'border-blue-500',
      bgColor: 'bg-blue-50',
      symptoms: [
        'Pitos (sibilancias) al respirar.',
        'Sensación de ahogo o opresión.',
        'Tos seca persistente.',
        'Dificultad para terminar frases.'
      ],
      actions: [
        { step: 'Posición Fowler', text: 'Sentado inclinado hacia delante.' },
        { step: 'Medicación', text: 'Ayudar con su inhalador de rescate.' },
        { step: 'Tranquilizar', text: 'El pánico empeora la falta de aire.' },
        { step: 'Ambiente limpio', text: 'Alejar de humos o alérgenos.' }
      ]
    },
    {
      id: 'endo',
      title: 'Urgencias Endocrinas',
      subtitle: 'Hipoglucemia',
      icon: <Droplet className="text-amber-500" />,
      color: 'border-amber-500',
      bgColor: 'bg-amber-50',
      symptoms: [
        'Sudor frío y temblor.',
        'Confusión o comportamiento extraño.',
        'Hambre repentina y debilidad.',
        'Visión borrosa.'
      ],
      actions: [
        { step: 'Azúcar rápido', text: 'Dar zumo o azúcar si está consciente.' },
        { step: 'Regla del 15', text: 'Esperar 15 min y repetir si no mejora.' },
        { step: 'Inconsciente', text: 'Posición Lateral de Seguridad (PLS). No dar comida.' },
        { step: 'Aviso médico', text: 'Si no recupera la consciencia tras el azúcar.' }
      ]
    }
  ];

  const quiz = [
    {
      case: "Un hombre se lleva la mano al pecho, suda frío y dice que el dolor le llega hasta la mandíbula.",
      options: ["Tumbarlo con los pies en alto", "Sentarlo apoyado y llamar al 112", "Darle un vaso de agua con azúcar", "Hacer que camine para calmarse"],
      correct: 1,
      tip: "En el infarto, el corazón debe trabajar lo menos posible. La posición semisentada y el reposo son críticos."
    },
    {
      case: "Ves a una mujer que no puede levantar el brazo derecho y al hablar parece confundida.",
      options: ["Esperar 30 minutos a ver si mejora", "Darle una aspirina", "Anotar la hora y llamar al 112", "Darle un masaje en el brazo"],
      correct: 2,
      tip: "Ante signos de Ictus, el tiempo es vital. Anotar la hora de inicio ayuda a los médicos a aplicar el tratamiento adecuado."
    },
    {
      case: "Un alumno diabético empieza a sudar frío, tiembla y parece muy irritado.",
      options: ["Darle un caramelo o zumo de inmediato", "Administrarle una inyección de insulina", "Hacer que se tumbe boca arriba", "Llevarlo a correr para quemar energía"],
      correct: 0,
      tip: "La hipoglucemia requiere azúcar rápido. Nunca des insulina si no eres personal médico o estás seguro del nivel de glucosa."
    }
  ];

  const handleAnswer = (idx) => {
    if (feedback !== null) return;
    const isCorrect = idx === quiz[currentQuestion].correct;
    if (isCorrect) setScore(score + 1);
    setFeedback(isCorrect ? 'correct' : 'incorrect');

    setTimeout(() => {
      setFeedback(null);
      if (currentQuestion + 1 < quiz.length) {
        setCurrentQuestion(currentQuestion + 1);
      } else {
        setShowResult(true);
      }
    }, 3000);
  };

  return (
    <div className="min-h-screen bg-gray-50 p-4 font-sans text-slate-900">
      <div className="max-w-4xl mx-auto">
        
        {/* Encabezado */}
        <header className="bg-white rounded-2xl p-6 shadow-sm border-b-4 border-indigo-600 mb-6">
          <div className="flex flex-col sm:flex-row justify-between items-center gap-4">
            <div>
              <h1 className="text-2xl font-black flex items-center gap-2">
                <Stethoscope className="text-indigo-600" /> SIMULADOR RA2.G
              </h1>
              <p className="text-slate-500 font-medium">Primeros Auxilios: Patologías Orgánicas</p>
            </div>
            <nav className="flex bg-slate-100 p-1 rounded-xl">
              <button 
                onClick={() => setActiveTab('learning')}
                className={`px-4 py-2 rounded-lg text-sm font-bold transition ${activeTab === 'learning' ? 'bg-white shadow-sm text-indigo-600' : 'text-slate-500'}`}
              >
                Protocolos
              </button>
              <button 
                onClick={() => setActiveTab('quiz')}
                className={`px-4 py-2 rounded-lg text-sm font-bold transition ${activeTab === 'quiz' ? 'bg-white shadow-sm text-indigo-600' : 'text-slate-500'}`}
              >
                Simulador
              </button>
            </nav>
          </div>
        </header>

        {/* Contenido Principal */}
        <main>
          {activeTab === 'learning' ? (
            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
              {/* Sidebar */}
              <div className="space-y-3">
                {pathologies.map(p => (
                  <button 
                    key={p.id}
                    onClick={() => setSelectedPathology(p)}
                    className={`w-full p-4 rounded-xl border-2 flex items-center gap-4 transition shadow-sm ${selectedPathology?.id === p.id ? 'bg-white border-indigo-500' : 'bg-white border-transparent hover:border-slate-200'}`}
                  >
                    <div className={`${p.bgColor} p-2 rounded-lg`}>{p.icon}</div>
                    <span className="font-bold text-sm text-left">{p.subtitle}</span>
                  </button>
                ))}
              </div>

              {/* Detalle */}
              <div className="md:col-span-2">
                {selectedPathology ? (
                  <div className="bg-white rounded-2xl shadow-sm overflow-hidden border border-slate-200 animate-in fade-in slide-in-from-bottom-2">
                    <div className={`p-6 ${selectedPathology.bgColor} border-b border-slate-100`}>
                      <h2 className="text-xl font-black uppercase flex items-center gap-2">
                        {selectedPathology.icon} {selectedPathology.subtitle}
                      </h2>
                    </div>
                    <div className="p-6 space-y-8">
                      <section>
                        <h3 className="text-xs font-black text-slate-400 uppercase tracking-widest mb-4 flex items-center gap-2">
                          <Activity size={14} /> Sintomatología
                        </h3>
                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-2">
                          {selectedPathology.symptoms.map((s, i) => (
                            <div key={i} className="flex items-center gap-2 text-sm bg-slate-50 p-3 rounded-lg border border-slate-100">
                              <div className="w-1.5 h-1.5 rounded-full bg-slate-400" /> {s}
                            </div>
                          ))}
                        </div>
                      </section>

                      <section>
                        <h3 className="text-xs font-black text-indigo-400 uppercase tracking-widest mb-4 flex items-center gap-2">
                          <ShieldCheck size={14} /> Actuación de Primeros Auxilios
                        </h3>
                        <div className="space-y-3">
                          {selectedPathology.actions.map((a, i) => (
                            <div key={i} className="flex gap-4 p-4 bg-indigo-50/50 rounded-xl border border-indigo-100">
                              <span className="font-black text-indigo-300">0{i+1}</span>
                              <div>
                                <p className="font-bold text-indigo-900 text-sm leading-none mb-1">{a.step}</p>
                                <p className="text-sm text-indigo-700">{a.text}</p>
                              </div>
                            </div>
                          ))}
                        </div>
                      </section>
                    </div>
                  </div>
                ) : (
                  <div className="h-full bg-white rounded-2xl border-2 border-dashed border-slate-200 flex flex-col items-center justify-center p-12 text-slate-400">
                    <Stethoscope size={48} className="mb-4 opacity-20" />
                    <p className="text-center font-medium">Selecciona una patología para ver el protocolo de actuación.</p>
                  </div>
                )}
              </div>
            </div>
          ) : (
            <div className="max-w-2xl mx-auto">
              {!quizStarted ? (
                <div className="bg-white p-12 rounded-3xl shadow-xl text-center">
                  <div className="w-20 h-20 bg-indigo-600 text-white rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-lg rotate-3">
                    <Zap size={40} />
                  </div>
                  <h2 className="text-3xl font-black mb-4">Simulador de Casos</h2>
                  <p className="text-slate-500 mb-8">Pon a prueba tu capacidad de reacción ante urgencias reales.</p>
                  <button 
                    onClick={() => setQuizStarted(true)}
                    className="w-full bg-slate-900 text-white py-4 rounded-xl font-bold hover:bg-indigo-600 transition shadow-lg"
                  >
                    COMENZAR ENTRENAMIENTO
                  </button>
                </div>
              ) : showResult ? (
                <div className="bg-white p-12 rounded-3xl shadow-xl text-center">
                  <h3 className="text-5xl font-black text-indigo-600 mb-2">{score}/{quiz.length}</h3>
                  <p className="text-slate-500 mb-8 font-bold uppercase tracking-widest">Resultado de la simulación</p>
                  <button 
                    onClick={() => {setQuizStarted(false); setShowResult(false); setScore(0); setCurrentQuestion(0);}}
                    className="flex items-center gap-2 bg-slate-900 text-white px-8 py-4 rounded-xl mx-auto font-bold"
                  >
                    <RotateCcw size={18} /> Volver a Empezar
                  </button>
                </div>
              ) : (
                <div className="bg-white p-8 rounded-3xl shadow-xl border border-slate-100">
                  <div className="flex justify-between items-center mb-8">
                    <span className="text-[10px] font-black uppercase text-indigo-600 tracking-tighter">Caso Clínico {currentQuestion + 1}</span>
                    <div className="flex gap-1">
                      {quiz.map((_, i) => (
                        <div key={i} className={`h-1.5 w-6 rounded-full ${i === currentQuestion ? 'bg-indigo-500' : 'bg-slate-100'}`} />
                      ))}
                    </div>
                  </div>

                  <div className="bg-slate-50 p-6 rounded-2xl border-l-4 border-indigo-400 mb-8 font-medium italic text-slate-700">
                    "{quiz[currentQuestion].case}"
                  </div>

                  <div className="space-y-3">
                    {quiz[currentQuestion].options.map((opt, i) => (
                      <button 
                        key={i}
                        disabled={feedback !== null}
                        onClick={() => handleAnswer(i)}
                        className={`w-full p-4 rounded-xl text-left font-bold transition flex justify-between items-center ${
                          feedback === null ? 'bg-white border-2 border-slate-100 hover:border-indigo-400' :
                          i === quiz[currentQuestion].correct ? 'bg-emerald-50 border-2 border-emerald-500 text-emerald-700' :
                          'bg-slate-50 border-2 border-transparent text-slate-400'
                        }`}
                      >
                        <span className="text-sm">{opt}</span>
                        {feedback !== null && i === quiz[currentQuestion].correct && <CheckCircle2 size={18} />}
                      </button>
                    ))}
                  </div>

                  {feedback && (
                    <div className={`mt-6 p-4 rounded-xl flex gap-3 animate-in slide-in-from-top-2 ${feedback === 'correct' ? 'bg-emerald-50 text-emerald-800' : 'bg-red-50 text-red-800'}`}>
                      <Info size={20} className="flex-shrink-0" />
                      <p className="text-sm font-medium">{quiz[currentQuestion].tip}</p>
                    </div>
                  )}
                </div>
              )}
            </div>
          )}
        </main>

        <footer className="mt-8 flex justify-center items-center gap-6 text-slate-400">
          <div className="flex items-center gap-2">
            <PhoneCall size={16} className="text-red-400" />
            <span className="text-sm font-black">EMERGENCIAS 112</span>
          </div>
          <div className="flex items-center gap-2">
            <Clock size={16} />
            <span className="text-sm font-black">EL TIEMPO ES VIDA</span>
          </div>
        </footer>

      </div>
    </div>
  );
};

export default App;
